<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: maven | It's SOAP's Fault...]]></title>
  <link href="http://blog.poznachowski.pl/categories/maven/atom.xml" rel="self"/>
  <link href="http://blog.poznachowski.pl/"/>
  <updated>2015-10-19T21:00:29+02:00</updated>
  <id>http://blog.poznachowski.pl/</id>
  <author>
    <name><![CDATA[Grzegorz Poznachowski]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Befriend your changelog]]></title>
    <link href="http://blog.poznachowski.pl/2015/08/04/befriend-your-changelog/"/>
    <updated>2015-08-04T00:00:00+02:00</updated>
    <id>http://blog.poznachowski.pl/2015/08/04/befriend-your-changelog</id>
    <content type="html"><![CDATA[<p>If you are tired of maintaining your changelog files manually, following solution may help you as it helped me.</p>

<p>At my current company we have quite a lot of services to maintain. Some time ago we introduced proper versioning and releasing.
That was a great step forward, but we were still missing an important piece. We wanted to have an easy way to know what was
introduced (features &amp; bug fixes) in each version. Appending information to a changelog file manually quickly became 
tedious job, as our release cycles can be very short.</p>

<p>To overcome this, I came up with a solution of having the changelog file generated automatically out of git commit messages.
It consists of two parts. First is about adding a generated html file to a released Maven artifact, so it can be easily accessible
in Maven artifacts repository (such as Nexus). Second part is about keeping up-to-date changelog.md file in the project root folder.</p>

<p>This fit our git-flow releasing cycle flawlessly (whole process occurs in a release branch). I already described our cycle <a href="http://neoteric.eu/2015/04/make-jenkins-speak-git-flow/">here</a>. 
However, it shouldn’t be much of a hassle to adapt the solution to your preffered flow.</p>

<p>Core part of the solution is the <a href="http://danielflower.github.io/maven-gitlog-plugin/">maven-gitlog-plugin</a> created by Daniel Flower.
It’s a simple tool, that gets most of the job done. It generates changelog out of the git commits. It can output to a text, markdown, HTML or even JSON file.
It supports GitHub and JIRA issue trackers and its configuration is really easy.</p>

<p>All of the below xml snippets are a part of our ‘release’ Maven profile.</p>

<p><strong>Baseline is to have the gitlog plugin set up and configured in pom.xml:</strong></p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span>    <span class="tag">&lt;plugin&gt;</span>
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span>        <span class="tag">&lt;groupId&gt;</span>com.github.danielflower.mavenplugins<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span>        <span class="tag">&lt;artifactId&gt;</span>gitlog-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span>        <span class="tag">&lt;configuration&gt;</span>
<span class="line-numbers"> <a href="#n5" name="n5">5</a></span>            <span class="tag">&lt;fullGitMessage&gt;</span>true<span class="tag">&lt;/fullGitMessage&gt;</span>
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>            <span class="tag">&lt;excludeCommiters&gt;</span>
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>                <span class="tag">&lt;commiter&gt;</span>jenkins<span class="tag">&lt;/commiter&gt;</span>
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>            <span class="tag">&lt;/excludeCommiters&gt;</span>
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span>            <span class="tag">&lt;dateFormat&gt;</span>yyyy-MM-dd<span class="tag">&lt;/dateFormat&gt;</span>
<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span>            <span class="tag">&lt;markdownChangeLogFilename&gt;</span>CHANGELOG.md<span class="tag">&lt;/markdownChangeLogFilename&gt;</span>
<span class="line-numbers"><a href="#n11" name="n11">11</a></span>            <span class="tag">&lt;generateMarkdownChangeLog&gt;</span>true<span class="tag">&lt;/generateMarkdownChangeLog&gt;</span>
<span class="line-numbers"><a href="#n12" name="n12">12</a></span>            <span class="tag">&lt;generateJSONChangeLog&gt;</span>false<span class="tag">&lt;/generateJSONChangeLog&gt;</span>
<span class="line-numbers"><a href="#n13" name="n13">13</a></span>            <span class="tag">&lt;generatePlainTextChangeLog&gt;</span>false<span class="tag">&lt;/generatePlainTextChangeLog&gt;</span>
<span class="line-numbers"><a href="#n14" name="n14">14</a></span>            <span class="tag">&lt;outputDirectory&gt;</span>${project.basedir}<span class="tag">&lt;/outputDirectory&gt;</span>
<span class="line-numbers"><a href="#n15" name="n15">15</a></span>        <span class="tag">&lt;/configuration&gt;</span>
<span class="line-numbers"><a href="#n16" name="n16">16</a></span>        <span class="tag">&lt;executions&gt;</span>
<span class="line-numbers"><a href="#n17" name="n17">17</a></span>            <span class="tag">&lt;execution&gt;</span>
<span class="line-numbers"><a href="#n18" name="n18">18</a></span>                <span class="tag">&lt;goals&gt;</span>
<span class="line-numbers"><a href="#n19" name="n19">19</a></span>                    <span class="tag">&lt;goal&gt;</span>generate<span class="tag">&lt;/goal&gt;</span>
<span class="line-numbers"><strong><a href="#n20" name="n20">20</a></strong></span>                <span class="tag">&lt;/goals&gt;</span>
<span class="line-numbers"><a href="#n21" name="n21">21</a></span>            <span class="tag">&lt;/execution&gt;</span>
<span class="line-numbers"><a href="#n22" name="n22">22</a></span>        <span class="tag">&lt;/executions&gt;</span>
<span class="line-numbers"><a href="#n23" name="n23">23</a></span>    <span class="tag">&lt;/plugin&gt;</span>
</pre></div>
</div>
</div>

<p>Important difference (in contrast to defaults) is  outputDirectory value. Instead of having changelog generated in the target folder, we want it to appear in
 project root folder - to commit the files later on. Everything else is rather self-explanatory.</p>

<p><strong>To attach changelog.html to a released Maven artifact we need to use builder-helper-maven-plugin:</strong></p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span>    <span class="tag">&lt;plugin&gt;</span>
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span>        <span class="tag">&lt;groupId&gt;</span>org.codehaus.mojo<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span>        <span class="tag">&lt;artifactId&gt;</span>build-helper-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span>        <span class="tag">&lt;executions&gt;</span>
<span class="line-numbers"> <a href="#n5" name="n5">5</a></span>            <span class="tag">&lt;execution&gt;</span>
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>                <span class="tag">&lt;id&gt;</span>attach-artifacts<span class="tag">&lt;/id&gt;</span>
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>                <span class="tag">&lt;phase&gt;</span>package<span class="tag">&lt;/phase&gt;</span>
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>                <span class="tag">&lt;goals&gt;</span>
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span>                    <span class="tag">&lt;goal&gt;</span>attach-artifact<span class="tag">&lt;/goal&gt;</span>
<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span>                <span class="tag">&lt;/goals&gt;</span>
<span class="line-numbers"><a href="#n11" name="n11">11</a></span>                <span class="tag">&lt;configuration&gt;</span>
<span class="line-numbers"><a href="#n12" name="n12">12</a></span>                    <span class="tag">&lt;artifacts&gt;</span>
<span class="line-numbers"><a href="#n13" name="n13">13</a></span>                        <span class="tag">&lt;artifact&gt;</span>
<span class="line-numbers"><a href="#n14" name="n14">14</a></span>                            <span class="tag">&lt;file&gt;</span>changelog.html<span class="tag">&lt;/file&gt;</span>
<span class="line-numbers"><a href="#n15" name="n15">15</a></span>                            <span class="tag">&lt;type&gt;</span>html<span class="tag">&lt;/type&gt;</span>
<span class="line-numbers"><a href="#n16" name="n16">16</a></span>                            <span class="tag">&lt;classifier&gt;</span>changelog<span class="tag">&lt;/classifier&gt;</span>
<span class="line-numbers"><a href="#n17" name="n17">17</a></span>                        <span class="tag">&lt;/artifact&gt;</span>
<span class="line-numbers"><a href="#n18" name="n18">18</a></span>                    <span class="tag">&lt;/artifacts&gt;</span>
<span class="line-numbers"><a href="#n19" name="n19">19</a></span>                <span class="tag">&lt;/configuration&gt;</span>
<span class="line-numbers"><strong><a href="#n20" name="n20">20</a></strong></span>            <span class="tag">&lt;/execution&gt;</span>
<span class="line-numbers"><a href="#n21" name="n21">21</a></span>        <span class="tag">&lt;/executions&gt;</span>
<span class="line-numbers"><a href="#n22" name="n22">22</a></span>    <span class="tag">&lt;/plugin&gt;</span>
</pre></div>
</div>
</div>

<p>Then in Nexus we can easily navigate to the changelog:</p>

<p><img src="/images/changelog/nexus.jpg"></p>

<p>Sample html output is available <a href="http://s000.tinyupload.com/index.php?file_id=62694510974038154928">here</a>.</p>

<p><strong>Keeping up-to-date changelog in your project folder requires additional step of commiting and pushing newly generated files:</strong></p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span>    <span class="tag">&lt;plugin&gt;</span>
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span>        <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span>        <span class="tag">&lt;artifactId&gt;</span>maven-scm-plugin<span class="tag">&lt;/artifactId&gt;</span>
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span>        <span class="tag">&lt;executions&gt;</span>
<span class="line-numbers"> <a href="#n5" name="n5">5</a></span>            <span class="tag">&lt;execution&gt;</span>
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>                <span class="tag">&lt;id&gt;</span>add-changelog-to-git<span class="tag">&lt;/id&gt;</span>
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>                <span class="tag">&lt;phase&gt;</span>package<span class="tag">&lt;/phase&gt;</span>
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>                <span class="tag">&lt;goals&gt;</span>
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span>                    <span class="tag">&lt;goal&gt;</span>add<span class="tag">&lt;/goal&gt;</span>
<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span>                    <span class="tag">&lt;goal&gt;</span>checkin<span class="tag">&lt;/goal&gt;</span>
<span class="line-numbers"><a href="#n11" name="n11">11</a></span>                <span class="tag">&lt;/goals&gt;</span>
<span class="line-numbers"><a href="#n12" name="n12">12</a></span>                <span class="tag">&lt;configuration&gt;</span>
<span class="line-numbers"><a href="#n13" name="n13">13</a></span>                    <span class="tag">&lt;basedir&gt;</span>./<span class="tag">&lt;/basedir&gt;</span>
<span class="line-numbers"><a href="#n14" name="n14">14</a></span>                    <span class="tag">&lt;includes&gt;</span>CHANGELOG.md, changelog.html<span class="tag">&lt;/includes&gt;</span>
<span class="line-numbers"><a href="#n15" name="n15">15</a></span>                    <span class="tag">&lt;message&gt;</span>Add changelog<span class="tag">&lt;/message&gt;</span>
<span class="line-numbers"><a href="#n16" name="n16">16</a></span>                    <span class="tag">&lt;pushChanges&gt;</span>true<span class="tag">&lt;/pushChanges&gt;</span>
<span class="line-numbers"><a href="#n17" name="n17">17</a></span>                <span class="tag">&lt;/configuration&gt;</span>
<span class="line-numbers"><a href="#n18" name="n18">18</a></span>            <span class="tag">&lt;/execution&gt;</span>
<span class="line-numbers"><a href="#n19" name="n19">19</a></span>        <span class="tag">&lt;/executions&gt;</span>
<span class="line-numbers"><strong><a href="#n20" name="n20">20</a></strong></span>    <span class="tag">&lt;/plugin&gt;</span>
</pre></div>
</div>
</div>

<p>Maven scm plugin needs scm element specified. I had problems with defining Git addresses properly, but <a href="http://stackoverflow.com/a/15391341/2514330">this</a> Stack Overflow
 response did the trick:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>    <span class="tag">&lt;scm&gt;</span>
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>        <span class="tag">&lt;url&gt;</span>https://github.com/XXX/YYY<span class="tag">&lt;/url&gt;</span>
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>        <span class="tag">&lt;connection&gt;</span>scm:git:ssh://git@github.com/XXX/YYY.git<span class="tag">&lt;/connection&gt;</span>
<span class="line-numbers"><a href="#n4" name="n4">4</a></span>        <span class="tag">&lt;developerConnection&gt;</span>scm:git:ssh://git@github.com/XXX/YYY.git<span class="tag">&lt;/developerConnection&gt;</span>
<span class="line-numbers"><a href="#n5" name="n5">5</a></span>    <span class="tag">&lt;/scm&gt;</span>
</pre></div>
</div>
</div>

<p>That’s it. Your changelog always stay fresh. However, there is one catch from now on.
You should pay attention to quality of your commit messages (nice writing on that by Chris Beams <a href="http://chris.beams.io/posts/git-commit/">here</a>).
But… you was already doing that, right?</p>
]]></content>
  </entry>
  
</feed>
